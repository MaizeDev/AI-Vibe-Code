<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player</title>
<style>
  :root {
    --glass-bg: rgba(120, 80, 50, 0.35); /* 棕色毛玻璃 */
    --accent: #e4c28f;                   /* 金棕高亮 */
    --text: #ffffff;
    --dark: #4b3621;
    --border: rgba(255, 255, 255, 0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    height: 100vh;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: var(--text);
    background: #4b3621 center/cover no-repeat fixed; /* 备用深棕 */
  }

  /* 侧边栏 */
  .sidebar {
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 80px;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 30px;
    z-index: 30;
  }
  .logo {
    font-size: 48px;
    font-weight: bold;
    color: var(--accent);
    margin-bottom: 60px;
  }
  .sidebar-icon {
    width: 44px;
    height: 44px;
    margin: 12px 0;
    color: var(--accent);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    transition: background 0.3s;
  }
  .sidebar-icon:hover { background: rgba(255,255,255,0.1); }
  .sidebar-icon svg { width: 26px; height: 26px; fill: currentColor; }

  /* 顶部图标 */
  .top-bar {
    position: fixed;
    top: 0;
    left: 80px;
    right: 0;
    height: 70px;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: flex-end;
    align-items: center;
    padding: 0 30px;
    z-index: 20;
  }
  .top-icons .sidebar-icon { margin-left: 20px; }

  /* 大播放按钮 */
  .big-play {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 220px;
    height: 220px;
    background: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    z-index: 5;
  }
  .big-play svg { width: 90px; height: 90px; fill: var(--dark); }

  /* 底部播放条 */
  .player-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 110px;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-top: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 12px 30px;
    z-index: 30;
  }
  .player-upper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .song-info h2 { font-size: 18px; margin: 0; }
  .song-info p { font-size: 14px; opacity: 0.8; margin-top: 4px; }
  .controls {
    display: flex;
    align-items: center;
    gap: 30px;
  }
  .controls .sidebar-icon { width: 50px; height: 50px; }
  .play-pause-small svg { width: 32px; height: 32px; }

  .progress-area {
    display: flex;
    align-items: center;
    width: 100%;
  }
  .current-time, .duration { font-size: 13px; min-width: 46px; }
  .progress {
    flex: 1;
    height: 5px;
    background: rgba(255,255,255,0.2);
    border-radius: 3px;
    margin: 0 12px;
    overflow: hidden;
  }
  .progress input[type="range"] {
    width: 100%;
    -webkit-appearance: none;
    background: transparent;
  }
  .progress input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
  }

  /* 歌词 */
  .lyrics {
    position: absolute;
    bottom: 140px;
    left: 100px;
    right: 20px;
    text-align: center;
    max-height: 40vh;
    overflow: hidden;
    pointer-events: none;
  }
  .lyrics-line {
    font-size: 20px;
    margin: 8px 0;
    opacity: 0.6;
    transition: all 0.4s;
  }
  .current-line {
    font-size: 32px;
    opacity: 1;
    color: var(--accent);
  }

  /* 搜索叠加层 */
  .search-overlay {
    position: fixed;
    top: 70px;
    left: 80px;
    right: 0;
    bottom: 110px;
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    display: none;
    flex-direction: column;
    padding: 20px;
    z-index: 25;
  }
  .search-input {
    width: 100%;
    padding: 16px 20px;
    font-size: 20px;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 30px;
    color: var(--text);
    outline: none;
  }
  .results {
    flex: 1;
    overflow-y: auto;
    margin-top: 20px;
  }
  .result-item {
    display: flex;
    align-items: center;
    padding: 12px;
    cursor: pointer;
    border-radius: 12px;
    transition: background 0.3s;
  }
  .result-item:hover { background: rgba(255,255,255,0.1); }
  .result-item img {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    margin-right: 16px;
    background: #666;
  }

  /* 响应式 */
  @media (max-width: 768px) {
    .sidebar { width: 60px; }
    .logo { font-size: 36px; }
    .top-bar { left: 60px; padding: 0 16px; }
    .search-overlay { left: 60px; }
    .big-play { width: 160px; height: 160px; }
    .big-play svg { width: 70px; height: 70px; }
  }
</style>
</head>
<body>

<audio id="audio" preload="auto"></audio>

<div class="sidebar">
  <div class="logo">M</div>
  <div class="sidebar-icon home-icon" title="首页/榜单">
    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  </div>
  <div class="sidebar-icon list-icon" title="示例歌单">
    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-12v2h14V7H7z"/></svg>
  </div>
  <div class="sidebar-icon" title="我的">
    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3a5 5 0 0 0-5 5v4h2V8a3 3 0 0 1 6 0v4h2V8a5 5 0 0 0-5-5z m-8 12h16v2H4z"/></svg>
  </div>
  <div class="sidebar-icon" title="分享">
    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
  </div>
  <div class="sidebar-icon person-icon" style="margin-top: auto;" title="个人">
    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
  </div>
</div>

<div class="top-bar">
  <div class="top-icons">
    <div class="sidebar-icon search-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
    </div>
    <div class="sidebar-icon">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
    </div>
  </div>
</div>

<div class="big-play" id="big-play-btn">
  <svg viewBox="0 0 24 24" id="big-play-icon">
    <path d="M8 5v14l11-7z" fill="var(--dark)"/>
  </svg>
</div>

<div class="lyrics" id="lyrics"></div>

<div class="player-bar">
  <div class="player-upper">
    <div class="song-info">
      <h2 id="title">Song Title</h2>
      <p id="artist">Artist Name</p>
    </div>
    <div class="controls">
      <div class="sidebar-icon previous-btn">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15 18l-9-6 9-6v12z"/></svg>
      </div>
      <div class="sidebar-icon play-pause-small" id="play-pause-small">
        <svg viewBox="0 0 24 24" id="small-icon">
          <path d="M6 4h4v16H6z m8 0h4v16h-4z" fill="currentColor"/>
        </svg>
      </div>
      <div class="sidebar-icon next-btn">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 6l9 6-9 6V6z"/></svg>
      </div>
    </div>
  </div>
  <div class="progress-area">
    <span id="current-time">0:00</span>
    <div class="progress">
      <input type="range" class="progress-bar" value="0" min="0" max="100" step="0.1">
    </div>
    <span id="duration">0:00</span>
  </div>
</div>

<div class="search-overlay" id="search-overlay">
  <input type="text" class="search-input" placeholder="搜索歌曲、歌手..." id="search-input">
  <div class="results" id="results"></div>
</div>

<script>
  const API = 'https://music-dl.sayqz.com/api/';
  const audio = document.getElementById('audio');
  const bigPlayBtn = document.getElementById('big-play-btn');
  const bigIcon = document.getElementById('big-play-icon');
  const smallPlayPause = document.getElementById('play-pause-small');
  const smallIcon = document.getElementById('small-icon');
  const progress = document.querySelector('.progress-bar');
  const currentTimeEl = document.getElementById('current-time');
  const durationEl = document.getElementById('duration');
  const titleEl = document.getElementById('title');
  const artistEl = document.getElementById('artist');
  const lyricsEl = document.getElementById('lyrics');
  const searchOverlay = document.getElementById('search-overlay');
  const searchInput = document.getElementById('search-input');
  const resultsEl = document.getElementById('results');

  let lyricsLines = [];

  function formatTime(s) {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec.toString().padStart(2, '0')}`;
  }

  audio.addEventListener('timeupdate', () => {
    if (audio.duration) {
      const per = (audio.currentTime / audio.duration) * 100;
      progress.value = per;
      currentTimeEl.textContent = formatTime(audio.currentTime);

      // 高亮歌词
      let idx = lyricsLines.findIndex(l => l.time > audio.currentTime) - 1;
      if (idx < 0) idx = lyricsLines.length - 1;
      lyricsEl.querySelectorAll('.lyrics-line').forEach(l => l.classList.remove('current-line'));
      if (idx >= 0) lyricsEl.children[idx].classList.add('current-line');
    }
  });

  audio.addEventListener('loadedmetadata', () => {
    durationEl.textContent = formatTime(audio.duration);
  });

  progress.addEventListener('input', () => {
    audio.currentTime = (progress.value / 100) * audio.duration;
  });

  function togglePlay() {
    if (audio.paused) {
      audio.play();
      bigIcon.innerHTML = '<path d="M6 4h4v16H6z m8 0h4v16h-4z" fill="var(--dark)"/>';
      smallIcon.innerHTML = '<path d="M6 4h4v16H6z m8 0h4v16h-4z" fill="currentColor"/>';
    } else {
      audio.pause();
      bigIcon.innerHTML = '<path d="M8 5v14l11-7z" fill="var(--dark)"/>';
      smallIcon.innerHTML = '<path d="M8 5v14l11-7z" fill="currentColor"/>';
    }
  }

  bigPlayBtn.onclick = smallPlayPause.onclick = togglePlay;

  // 搜索
  document.querySelector('.search-icon').parentElement.onclick = () => {
    searchOverlay.style.display = 'flex';
    searchInput.focus();
  };

  let timeout;
  searchInput.oninput = () => {
    clearTimeout(timeout);
    const kw = searchInput.value.trim();
    if (kw.length < 2) { resultsEl.innerHTML = ''; return; }
    timeout = setTimeout(async () => {
      try {
        const r = await fetch(`${API}?type=aggregateSearch&keyword=${encodeURIComponent(kw)}`);
        const json = await r.json();
        resultsEl.innerHTML = '';
        (json.data || []).slice(0, 20).forEach(song => {
          const div = document.createElement('div');
          div.className = 'result-item';
          const artists = Array.isArray(song.artists) ? song.artists.join(', ') : song.artist || '未知';
          div.innerHTML = `
            <img src="${song.pic || ''}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjY2NjIi8+PC9zdmc+'">
            <div>
              <div>${song.name || '未知歌曲'}</div>
              <div style="opacity:0.7;font-size:14px;">${artists} • ${song.source || ''}</div>
            </div>
          `;
          div.onclick = () => loadSong(song);
          resultsEl.appendChild(div);
        });
      } catch (e) {
        resultsEl.innerHTML = '<div style="text-align:center;color:#faa;">加载失败</div>';
      }
    }, 400);
  };

  async function loadSong(song) {
    searchOverlay.style.display = 'none';
    titleEl.textContent = song.name || '未知歌曲';
    artistEl.textContent = Array.isArray(song.artists) ? song.artists.join(', ') : song.artist || '未知歌手';

    try {
      // 音频链接（高品质）
      const urlRes = await fetch(`${API}?source=${song.source}&id=${song.id}&type=url&br=320k`);
      const urlJson = await urlRes.json();
      audio.src = urlJson.data || urlJson.url || '';
      audio.load();

      // 封面 → 背景
      let pic = song.pic;
      if (!pic) {
        const picRes = await fetch(`${API}?source=${song.source}&id=${song.id}&type=pic`);
        pic = picRes.url || '';
      }
      if (pic) document.body.style.backgroundImage = `url(${pic})`;

      // 歌词
      const lrcRes = await fetch(`${API}?source=${song.source}&id=${song.id}&type=lrc`);
      const lrcText = await lrcRes.text();
      parseLyrics(lrcText);

      audio.play();
      togglePlay(); // 切换到暂停图标
    } catch (e) {
      alert('加载歌曲失败，请重试');
    }
  }

  function parseLyrics(text) {
    lyricsEl.innerHTML = '';
    lyricsLines = [];
    const lines = text.split('\n');
    lines.forEach(line => {
      const m = line.match(/\[((\d+):(\d+\.\d+))\](.*)/);
      if (m) {
        const min = parseInt(m[2]);
        const sec = parseFloat(m[3]);
        const time = min * 60 + sec;
        const lyric = m[4].trim();
        if (lyric) {
          lyricsLines.push({time, text: lyric});
          const div = document.createElement('div');
          div.className = 'lyrics-line';
          div.textContent = lyric;
          lyricsEl.appendChild(div);
        }
      }
    });
    lyricsLines.sort((a,b) => a.time - b.time);
  }

  // 示例榜单（点击侧边栏“首页”图标加载热门榜单）
  document.querySelector('.home-icon').parentElement.onclick = async () => {
    searchOverlay.style.display = 'flex';
    results