<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜é›…æˆªå›¾ V8 (çœŸæœºæ¨¡å‹ç‰ˆ) - By Antigravity</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #e5e5e5; }
        
        /* é¢„è§ˆåŒºå¸ƒå±€ */
        #preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            padding-bottom: 100px;
        }

        /* --- æ ¸å¿ƒï¼šè®¾å¤‡æ ·å¼å®šä¹‰ --- */

        /* 1. é€šç”¨å¡ç‰‡å®¹å™¨ */
        .capture-wrapper {
            position: relative;
            box-sizing: border-box;
            transition: all 0.3s ease;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden; /* é˜²æ­¢èƒŒæ™¯æº¢å‡ºåœ†è§’ */
        }

        /* 2. Mac æ¨¡å¼ï¼šè‡ªé€‚åº”é«˜åº¦ï¼Œç»å…¸çš„çª—å£ */
        .mode-mac {
            width: 680px;
            border-radius: 16px;
        }
        .mode-mac .content-area {
            min-height: 200px;
            /* é«˜åº¦éšå†…å®¹æ’‘å¼€ */
        }
        .mode-mac .mac-header { display: flex; }
        .mode-mac .iphone-frame, 
        .mode-mac .iphone-status-bar, 
        .mode-mac .iphone-home-indicator { display: none; }

        /* 3. iPhone æ¨¡å¼ï¼šå›ºå®šæ¯”ä¾‹ï¼Œç»å¯¹å®šä½ */
        .mode-iphone {
            /* iPhone 14/15/16 Pro Max æ¯”ä¾‹ (430 x 932) */
            width: 430px; 
            height: 932px; 
            border-radius: 56px; /* åŒ¹é… SVG è¾¹æ¡†çš„åœ†è§’ */
            background-color: #fff; /* é»˜è®¤ç™½åº• */
        }

        /* iPhone çš„ SVG è¾¹æ¡†å±‚ï¼Œæµ®åœ¨æœ€ä¸Šé¢ */
        .mode-iphone .iphone-frame {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€ */
            z-index: 50; /* æœ€é«˜å±‚çº§ */
        }

        /* iPhone çš„å†…å®¹å±‚ï¼Œå¿…é¡»é™åˆ¶åœ¨å®‰å…¨åŒºåŸŸå†… */
        .mode-iphone .content-area {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding-top: 60px; /* é¿å¼€çµåŠ¨å²› */
            padding-bottom: 40px; /* é¿å¼€ Home Indicator */
            padding-left: 28px;
            padding-right: 28px;
            box-sizing: border-box;
            z-index: 10;
            overflow: hidden; /* å†…å®¹è¿‡å¤šåˆ‡æ–­ï¼ˆç”±åˆ†é¡µé€»è¾‘å¤„ç†ï¼‰ */
        }

        /* éšè— Mac å…ƒç´  */
        .mode-iphone .mac-header, 
        .mode-iphone .mac-footer { display: none; }

        /* çŠ¶æ€æ  & åº•éƒ¨æ¡ */
        .mode-iphone .iphone-status-bar {
            position: absolute;
            top: 14px; left: 35px; right: 35px;
            height: 30px;
            z-index: 40;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            font-weight: 600;
            color: #000;
        }
        .mode-iphone .iphone-home-indicator {
            position: absolute;
            bottom: 8px; left: 50%;
            transform: translateX(-50%);
            width: 140px; height: 5px;
            background: rgba(0,0,0,0.9);
            border-radius: 10px;
            z-index: 40;
        }

        /* MD æ ·å¼ */
        .prose code { color: #ec4899; background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 0.9em; }
        .prose pre { background: #1e293b; color: #e2e8f0; border-radius: 12px; margin: 1em 0; padding: 1em; }
        
        /* ä¸»é¢˜ç±» */
        .theme-white { background: #ffffff; }
        .theme-gradient-1 { background: linear-gradient(180deg, #e0c3fc 0%, #8ec5fc 100%); } /* iPhone é£æ ¼é€šå¸¸æ˜¯ç«–å‘æ¸å˜ */
        .theme-gradient-2 { background: linear-gradient(180deg, #a18cd1 0%, #fbc2eb 100%); }
        .theme-dark { background: #1e1e1e; color: #fff; }
        .theme-dark .prose { color: #e5e5e5; }
        .theme-dark .prose strong { color: #fff; }
        .theme-dark .iphone-status-bar { color: #fff; }
        .theme-dark .iphone-home-indicator { background: #fff; }

        /* æ§ä»¶æ ·å¼ */
        .btn-tab { @apply flex-1 py-2 text-xs font-bold rounded-lg transition-all border border-transparent; }
        .btn-tab.active { @apply bg-white shadow-sm text-gray-900 border-gray-200; }
        .btn-tab.inactive { @apply text-gray-500 hover:text-gray-700 hover:bg-gray-100; }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <div class="w-full md:w-96 bg-white p-6 flex flex-col border-r border-gray-200 z-10 shadow-xl overflow-y-auto">
        <h1 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
            <span class="text-2xl">ğŸ¨</span> æˆªå›¾å·¥åŠ V8
        </h1>
        
        <textarea id="text-input" class="w-full h-40 p-4 bg-gray-50 border border-gray-200 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-black/5 text-sm font-mono mb-6 shadow-inner" placeholder="è¾“å…¥å†…å®¹..."></textarea>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div class="mb-6">
            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 block">é€‰æ‹©è®¾å¤‡</label>
            <div class="flex bg-gray-100 p-1 rounded-xl">
                <button onclick="setMode('mac')" id="tab-mac" class="btn-tab active">Mac Window</button>
                <button onclick="setMode('iphone')" id="tab-iphone" class="btn-tab inactive">iPhone 16 Pro</button>
            </div>
        </div>

        <!-- é€‰é¡¹ -->
        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 mb-6 space-y-4">
            <div class="flex items-center justify-between">
                <span class="text-sm font-bold text-gray-600">è‡ªåŠ¨åˆ†é¡µ</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="split-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                </label>
            </div>
            
            <div class="space-y-2">
                <label class="text-xs font-bold text-gray-400 uppercase">èƒŒæ™¯ä¸»é¢˜</label>
                <div class="grid grid-cols-5 gap-3">
                    <button onclick="setTheme('theme-white')" class="w-8 h-8 rounded-full border border-gray-200 bg-white hover:scale-110 transition"></button>
                    <button onclick="setTheme('theme-gradient-1')" class="w-8 h-8 rounded-full theme-gradient-1 hover:scale-110 transition"></button>
                    <button onclick="setTheme('theme-gradient-2')" class="w-8 h-8 rounded-full theme-gradient-2 hover:scale-110 transition"></button>
                    <button onclick="setTheme('theme-dark')" class="w-8 h-8 rounded-full theme-dark hover:scale-110 transition"></button>
                </div>
            </div>
        </div>

        <button id="download-btn" class="mt-auto w-full bg-black text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex justify-center items-center gap-2">
            ç”Ÿæˆå›¾ç‰‡ (PNG/ZIP)
        </button>
    </div>

    <!-- å³ä¾§é¢„è§ˆ (ç°è‰²èƒŒæ™¯) -->
    <div class="flex-1 bg-[#e0e0e0] overflow-y-auto p-10 relative flex justify-center">
        <div class="absolute top-5 right-5 bg-black/5 px-3 py-1 rounded text-xs font-mono text-gray-500" id="page-info">1 Page</div>
        
        <div id="preview-container">
            <!-- å›¾ç‰‡å°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
        </div>
    </div>

    <!-- éšè—çš„ SVG èµ„æºï¼šiPhone 15/16 Pro è¾¹æ¡† -->
    <!-- è¿™æ˜¯ä¸€ä¸ªç²¾ç¡®ç»˜åˆ¶çš„ SVGï¼ŒåŒ…å«å¤–è¾¹æ¡†ã€å†…é»‘è¾¹ã€çµåŠ¨å²› -->
    <svg style="display: none;">
        <symbol id="iphone-bezel" viewBox="0 0 430 932">
            <!-- é’›é‡‘å±å¤–æ¡†é˜´å½± -->
            <rect x="2" y="2" width="426" height="928" rx="55" fill="none" stroke="#666" stroke-width="2" opacity="0.5"/>
            <!-- å±å¹•é»‘è¾¹ (Bezel) -->
            <path d="M56 0h318c30.9 0 56 25.1 56 56v820c0 30.9-25.1 56-56 56H56c-30.9 0-56-25.1-56-56V56C0 25.1 25.1 0 56 0z" fill="none" stroke="#111" stroke-width="14"/>
            <!-- çµåŠ¨å²› (Dynamic Island) -->
            <rect x="126" y="11" width="178" height="37" rx="18.5" fill="#000"/>
        </symbol>
    </svg>

    <script>
        marked.use({ breaks: true, gfm: true });

        const state = {
            mode: 'iphone', // é»˜è®¤ iPhone
            split: false,
            theme: 'theme-white',
            text: `# V8 ç»ˆæç‰ˆæ¼”ç¤º

æ— éœ€ä»»ä½•å›¾ç‰‡ç´ æï¼Œè¿™å°±æ˜¯çº¯ä»£ç ç”Ÿæˆçš„**å®Œç¾ iPhone è¾¹æ¡†**ã€‚

## æ ¸å¿ƒç‰¹æ€§

1. **å›ºå®šæ¯”ä¾‹**ï¼šå³ä½¿æ–‡å­—åªæœ‰ä¸€è¡Œï¼Œç”Ÿæˆçš„ä¹Ÿæ˜¯å®Œæ•´çš„æ‰‹æœºæˆªå›¾å¤§å°ã€‚
2. **çŸ¢é‡è¾¹æ¡†**ï¼šæ”¾å¤§çœ‹ç»†èŠ‚ï¼Œè¾¹ç¼˜æ— æ¯”é”åˆ©ã€‚
3. **è‡ªé€‚åº”**ï¼šè‡ªåŠ¨å¤„ç†çµåŠ¨å²›å’Œåº•éƒ¨æ¨ªæ¡çš„é®æŒ¡ã€‚

### å°è¯•ä¸€ä¸‹
- å¤åˆ¶ä¸€å¤§æ®µæ–‡ç« è¿›æ¥
- å¼€å¯ "è‡ªåŠ¨åˆ†é¡µ"
- æ¯ä¸€é¡µéƒ½æ˜¯ä¸€å¼ å®Œç¾çš„æ‰‹æœºæµ·æŠ¥

\`\`\`js
console.log("Hello, iPhone 16 Pro");
\`\`\`
`
        };

        const els = {
            input: document.getElementById('text-input'),
            container: document.getElementById('preview-container'),
            pageInfo: document.getElementById('page-info'),
            splitCheck: document.getElementById('split-toggle'),
            dlBtn: document.getElementById('download-btn'),
            tabMac: document.getElementById('tab-mac'),
            tabPhone: document.getElementById('tab-iphone')
        };

        // åˆå§‹åŒ–
        els.input.value = state.text;
        render();

        // ç›‘å¬å™¨
        els.input.addEventListener('input', (e) => { state.text = e.target.value; render(); });
        els.splitCheck.addEventListener('change', (e) => { state.split = e.target.checked; render(); });
        
        window.setMode = (m) => { 
            state.mode = m; 
            els.tabMac.className = m === 'mac' ? 'btn-tab active' : 'btn-tab inactive';
            els.tabPhone.className = m === 'iphone' ? 'btn-tab active' : 'btn-tab inactive';
            render(); 
        };
        
        window.setTheme = (t) => { state.theme = t; render(); };

        // --- æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ ---

        function createCardHTML(contentHTML, pageIndex, totalPages) {
            // æ ¹æ®æ¨¡å¼å†³å®šå¡ç‰‡ç»“æ„
            const isPhone = state.mode === 'iphone';
            
            // 1. æ„å»ºå¤´éƒ¨ (Mac æ‰æœ‰)
            const macHeader = `
                <div class="mac-header h-10 px-4 items-center gap-2 border-b border-black/5 bg-white/50 backdrop-blur-sm">
                    <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                    <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                    <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
                </div>`;

            // 2. æ„å»º iPhone ç‹¬æœ‰å…ƒç´  (SVG è¾¹æ¡† + çŠ¶æ€æ )
            // æ³¨æ„ï¼šSVG æ˜¯è¦†ç›–åœ¨æœ€ä¸Šå±‚çš„
            const timeStr = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: false});
            const iphoneOverlays = `
                <div class="iphone-status-bar">
                    <span>${timeStr}</span>
                    <div class="flex gap-1.5">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V7h2v5z"/></svg>
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/></svg>
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M16 4h-1V2.5C15 2.22 14.78 2 14.5 2h-5c-.28 0-.5.22-.5.5V4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z"/></svg>
                    </div>
                </div>
                <div class="iphone-home-indicator"></div>
                <svg class="iphone-frame" viewBox="0 0 430 932" preserveAspectRatio="none">
                    <use href="#iphone-bezel" />
                </svg>
            `;

            // 3. æ„å»º Mac åº•éƒ¨
            const macFooter = `
                <div class="mac-footer h-8 bg-black/5 flex justify-between items-center px-4 text-[10px] text-gray-500 font-mono">
                    <span>ANTIGRAVITY</span>
                    <span>${pageIndex + 1}/${totalPages}</span>
                </div>`;

            // ç»„è£… HTML
            return `
                <div class="capture-wrapper ${isPhone ? 'mode-iphone' : 'mode-mac'} ${state.theme}">
                    ${isPhone ? iphoneOverlays : macHeader}
                    <div class="content-area">
                        <div class="prose prose-slate max-w-none ${state.theme === 'theme-dark' ? 'prose-invert' : ''}">
                            ${contentHTML}
                        </div>
                    </div>
                    ${isPhone ? '' : macFooter}
                </div>
            `;
        }

        function render() {
            els.container.innerHTML = '';
            const fullHTML = marked.parse(state.text);

            let pages = [];

            if (!state.split) {
                // ä¸åˆ†é¡µï¼šMac æ¨¡å¼æ­£å¸¸é•¿å›¾ï¼ŒiPhone æ¨¡å¼...ç†è®ºä¸Šä¹Ÿåº”è¯¥æ˜¯é•¿å›¾è¿˜æ˜¯å›ºå®šï¼Ÿ
                // é€»è¾‘å†³å®šï¼šiPhone æ¨¡å¼ä¸‹å¦‚æœä¸åˆ†é¡µï¼Œæ–‡å­—è¶…é•¿ä¼šæº¢å‡ºéšè—ã€‚
                // ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¼ºåˆ¶è®© iPhone æ¨¡å¼å¦‚æœä¸åˆ†é¡µï¼Œå°±æ˜¾ç¤ºå…¨éƒ¨å†…å®¹ï¼ˆä½†è¿™ä¼šç ´åçœŸæœºæ¯”ä¾‹ï¼‰ã€‚
                // ä¸ºäº†ä¿æŒ V8 çš„ç‰¹æ€§â€œå®Œç¾è¾¹æ¡†â€ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ¼”ç¤ºâ€œåˆ†é¡µâ€æˆ–â€œå•é¡µæˆªæ–­â€ã€‚
                // è¿™é‡Œå¤„ç†ä¸ºï¼šå•é¡µæ˜¾ç¤ºã€‚
                pages = [fullHTML];
            } else {
                // æ™ºèƒ½åˆ†é¡µé€»è¾‘
                // 1. æ¨¡æ‹Ÿå®¹å™¨è®¡ç®—é«˜åº¦
                const ruler = document.createElement('div');
                ruler.className = `prose prose-slate max-w-none ${state.theme === 'theme-dark' ? 'prose-invert' : ''}`;
                // å®½åº¦ä¸€å®šè¦å’ŒçœŸå®å®¹å™¨å†…å®¹åŒºä¸€è‡´
                ruler.style.width = state.mode === 'iphone' ? '374px' : '640px'; 
                ruler.style.visibility = 'hidden';
                ruler.style.position = 'absolute';
                ruler.innerHTML = fullHTML;
                document.body.appendChild(ruler);

                // 2. è®¾å®šå®‰å…¨é«˜åº¦
                // iPhone: 932(æ€») - 60(ä¸Š) - 40(ä¸‹) = 832px
                // Mac: è‡ªå®šä¹‰ï¼Œæ¯”å¦‚ 600px
                const safeHeight = state.mode === 'iphone' ? 830 : 600;

                const nodes = Array.from(ruler.children);
                let currentH = 0;
                let buffer = [];

                nodes.forEach(node => {
                    const h = node.offsetHeight + 16; // ä¼°ç®— margin
                    if (currentH + h > safeHeight && buffer.length > 0) {
                        pages.push(buffer.map(n => n.outerHTML).join(''));
                        buffer = [];
                        currentH = 0;
                    }
                    buffer.push(node);
                    currentH += h;
                });
                if (buffer.length) pages.push(buffer.map(n => n.outerHTML).join(''));
                document.body.removeChild(ruler);
            }

            els.pageInfo.innerText = `${pages.length} Page${pages.length > 1 ? 's' : ''}`;

            pages.forEach((html, idx) => {
                const div = document.createElement('div');
                div.innerHTML = createCardHTML(html, idx, pages.length);
                els.container.appendChild(div.firstElementChild);
            });
        }

        // ä¸‹è½½
        els.dlBtn.addEventListener('click', async () => {
            const targets = document.querySelectorAll('.capture-wrapper');
            if(!targets.length) return;
            
            const btnText = els.dlBtn.innerText;
            els.dlBtn.innerText = 'ğŸ“¸ æ¸²æŸ“ä¸­...';
            els.dlBtn.disabled = true;

            try {
                // ç­‰å¾…å­—ä½“å’Œ SVG æ¸²æŸ“
                await new Promise(r => setTimeout(r, 300));

                if (targets.length === 1) {
                    const canvas = await html2canvas(targets[0], { scale: 3, useCORS: true, backgroundColor: null });
                    const link = document.createElement('a');
                    link.download = `screenshot_v8_${Date.now()}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                } else {
                    const zip = new JSZip();
                    for(let i=0; i<targets.length; i++) {
                        const canvas = await html2canvas(targets[i], { scale: 3, useCORS: true, backgroundColor: null });
                        const blob = await new Promise(r => canvas.toBlob(r));
                        zip.file(`slide_${i+1}.png`, blob);
                    }
                    const content = await zip.generateAsync({type:"blob"});
                    saveAs(content, `slides_package.zip`);
                }
            } catch(e) {
                console.error(e);
                alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°");
            } finally {
                els.dlBtn.innerText = btnText;
                els.dlBtn.disabled = false;
            }
        });

    </script>
</body>
</html>
