# 🍃 Ghibli App 开发手册

> **核心目标**：打造一个优雅、现代的吉卜力电影浏览 App。
> **设计风格**：iOS 26 概念设计（分岛式导航 + 磨砂玻璃质感）。

---

## 1. 🏗️ 架构设计：餐厅比喻法

为了不被代码绕晕，我们把这个 App 想象成一家 **“吉卜力主题餐厅”**。我们采用了 **MVVM** 架构，其实就是餐厅的三个角色：

| 角色     | 对应代码 (术语)                   | 职责 (通俗解释)                                              |
| :------- | :-------------------------------- | :----------------------------------------------------------- |
| **食材** | **Model** (`Movie.swift`)         | **原材料**。定义了电影长什么样（标题、海报、简介）。         |
| **大厨** | **ViewModel** (`AppStore.swift`)  | **加工者**。负责去仓库（API）拿食材，处理好，准备端给客人。  |
| **餐桌** | **View** (`MoviesFeedView.swift`) | **展示区**。客人看到的地方，负责把做好的菜（数据）漂亮地摆盘。 |

---

## 2. 👣 开发步骤：五步走

我们不是一上来就画界面，而是像盖房子一样，从地基开始。

### 第一步：定义数据 (Model)
**任务**：告诉 App，“电影”到底包含哪些信息？
*   **文件**：`Movie.swift`
*   **内容**：我们需要 `id` (身份证), `title` (名字), `image` (海报), `description` (简介)。
*   **关键点**：因为要收藏电影，所以我们用了 `SwiftData`（苹果自带的超级记事本）来保存数据。

### 第二步：获取数据 (Networking)
**任务**：派人去互联网上把数据取回来。
*   **文件**：`GhibliClient.swift`
*   **动作**：
    1.  **联网模式**：访问 `ghibliapi.vercel.app`。
    2.  **省流模式**：为了开发方便，我们加了一个开关 `useLocalData`，打开后直接读取本地写好的假数据，速度飞快。

### 第三步：管理状态 (ViewModel)
**任务**：连接数据和界面的桥梁。
*   **文件**：`AppStore.swift`
*   **功能**：
    *   它手里拿着一份 `movies` 列表。
    *   界面喊一声“我要看电影”，它就调用第二步的工具去取，然后更新列表。
    *   界面会自动感知到列表变了，然后刷新显示。

### 第三步：绘制界面 (UI Views)
**任务**：把数据漂亮地画在屏幕上。
*   **主列表** (`MoviesFeedView`)：像刷朋友圈一样展示电影卡片。
*   **详情页** (`MovieDetailView`)：点击卡片后进入，展示大图和详细故事。
*   **收藏页** (`FavoritesView`)：只显示你点了“红心”的电影。

### 第五步：注入灵魂 (Navigation)
**任务**：让 App 看起来不像十年前的产物。
*   **文件**：`FloatingTabBar.swift`
*   **设计**：抛弃传统的底部栏，改用 **“分岛式悬浮导航”**。

---

## 3. 🎨 核心代码解读 (只看最重要的)

### A. 那个很酷的“分岛式”导航栏
这是我们 App 的颜值担当。它把功能分成了两块：
1.  **左边长条**：日常操作（首页、收藏、设置）。
2.  **右边圆钮**：特殊操作（搜索）。

```swift
// FloatingTabBar.swift 的简化逻辑

HStack {
    // 🏝️ 左边的岛：功能区
    HStack {
        ForEach(mainTabs) { tab in
            // 点击时，让黑色胶囊滑过去
            if selectedTab == tab {
                Capsule().fill(Color.primary)
            }
        }
    }
    .background(.regularMaterial) // 👈 重点：这就是磨砂玻璃材质
  
    // 🏝️ 右边的岛：搜索区
    Button { ... }
        .background(Circle())
}
```

### B. 让导航栏变透明的“魔法”
为什么有些 App 的导航栏看起来灰灰的，而我们的是透亮的？

**秘密在于这一行代码：**

```swift
// ContentView.swift

MoviesFeedView()
    .ignoresSafeArea(edges: .bottom) // 👈 魔法！
```

*   **不加这行**：内容列表会怕挡住底部，缩在上面。导航栏下面是空的，所以不透明。
*   **加了这行**：内容列表直接铺满整个屏幕。当你滚动时，电影海报会滑过导航栏下方，磨砂玻璃就有了漂亮的模糊透视效果。

---

## 4. 🛠️ 避坑指南 (给未来的你)

1.  **图片加载慢？**
    *   我们用了 `AsyncImage`。如果网速慢，它会先显示一个灰色的占位图，不会让 App 卡死。

2.  **API 挂了怎么办？**
    *   别慌，去 `GhibliClient.swift` 把 `static let useLocalData = true` 打开。
    *   这样 App 就会读取 `LocalData.swift` 里的备份数据，演示完全不受影响。

3.  **报错 `Result values mismatch`？**
    *   这是因为 Swift 对类型要求很严。
    *   记住：`Color.red` 和 `.material` 是两种东西。如果要混用，必须给它们穿上同一件外套：`AnyShapeStyle(...)`。

---

## 5. 📝 总结

你现在拥有的是一个 **“麻雀虽小，五脏俱全”** 的现代 iOS App。
*   它有**云端数据**。
*   它有**本地数据库** (SwiftData)。
*   它有**顶级 UI 设计** (悬浮导航)。

**下一步建议**：
如果你想继续玩，可以试着给“搜索按钮”加上功能，或者给电影卡片加上点击时的缩放动画。

祝你编程愉快！🚀